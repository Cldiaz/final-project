<% include ../partials/header.ejs %>
<% include ../partials/navbar.ejs %>
<main class="container">
    <div class="white-bg">
    <img  class="center-block" src="/Assets/logo1.png">
    <h1> <%= title%></h1>
        <a href="/tickets/add">Add a new ticket</a>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Ticket Number</th>
                    <th>Date Submitted</th>
                    <th>Level of Priority</th>
                    <th>Ticket Title</th>
                    <th>Customer Name</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <% for (var i = 0; i < tickets.length; i++) { %>
                    <tr>
                        <td><a href="/tickets/<%= tickets[i]._id %>"><%= tickets[i].ticketNumber %></a></td>
                        <td><%= tickets[i].createdOn.toDateString() %></td>
                        <td><%= tickets[i].ticketPriority %></td>
                        <td><%= tickets[i].ticketTitle %></td>
                        <td><%= tickets[i].customerName %></td>
                        <td><% if (tickets[i].incidentNarrative !== undefined){ %> <%= tickets[i].incidentNarrative[tickets[i].incidentNarrative.length - 1].ticketStatus %> <%}%></td>
                    </tr>
                <% } %>
            </tbody>
        </table>
        
    <ul class="list-group">
        <% for (var i = 0; i < tickets.length; i++) { %>
            <li class="list-group-item">
                Ticket Title: 
                <a href="/tickets/<%= tickets[i]._id %>" title="Edit Ticket">
                    <%= tickets[i].ticketTitle %>
                </a>
                <br />
                Description: <%= tickets[i].ticketDescription %>
                <br />
                Priority: <%= tickets[i].ticketPriority %>
                <br />
                
                <br />
                Customer Name: <%= tickets[i].customerName %>
                <br />
                Customer Phone: <%= tickets[i].customerPhone %>
                <br />
                id: <%= tickets[i].createdBy %>
                <br />
                Incident Narrative :
                <br />
                <% if (tickets[i].incidentNarrative !== undefined) 
                   {
                        for (var c = 0; c < tickets[i].incidentNarrative.length; c++ ){%>
                        Comment: <%= tickets[i].incidentNarrative[c].comment %> || Date: <%= tickets[i].incidentNarrative[c].commentDate.toDateString() %>
                        <br>
                       <%}
                   }
                %>
                <br />
                Ticket Number: <%= tickets[i].ticketNumber %>
            </li>
        <% } %>
    </ul>
   </div> <!--./white-bg-->
</main>
<% include ../partials/footer.ejs %>